---
layout: post
title: "音频质量评估"
subtitle: '音频质量评估'
author: "叉叉敌"
header-style: text
tags:
  - 音频
  - 评估
  - PESQ
  - 测试
---

# 原理


# Audio
## 最基础
- 振幅， 保证输入的输出的在接受范围内
- 频率 同上
- dropout  输出不能有不连续的信号
- distortion 畸变，比如采样率发生变化 声音异常
- clipping  出现啸叫，顶峰没有数据

验证数据用的是

- 正玄波 sine-0db-1khz 这个主要是验证THD 和dropout
- step gain sine -60db~0db 可以验证clipping
- sweep 扫频 0khz~16Khz， 验证对每一个频率的处理
- speech， 验证distortion


## 影响声音质量的因素

- 压缩， 模拟型号转为数字pcm信号的时候就有丢失。提高采样率比如48k
- 延迟， 什么导致延迟，比如编码、打包、网络传输、jitter buffer
- jitter 抖动， udp传输 数据丢失，可以用jitter buffer来一职
- 丢包 udp传输，丢包是必然的 ，使用少量的丢包
- 回声 声学原因：布局、混响、延时大小、单双讲， 电学：信号干扰
- 其他噪音 




## 评估标准
- MOS 原始的就是一个主观的批判， 

根据提供给算法的信息，语音质量测试算法可分为两大类
1. `完全引用"（FR）`
算法可以访问并使用原始参考信号进行比较（即差异分析）。它可以比较参考信号的每个样本（说话端）与降级信号的每个对应样本（侦听器侧）。FR 测量可提供`最高的精度和可重复性`，但只能应用于实时网络中的专用测试（例如移动网络基准的驱动测试工具）

2. ` "无参考"（NR)`
算法仅使用降级信号进行质量评估，并且没有原始参考信号的信息。NR 算法只是`低准确性估计值`，因为源引用的原发语音特征（例如男性或女性说话者、背景噪音、非语音）完全未知。NR 算法的常见`变体甚至不分析解码的音频信号`，而是对 IP 数据包级别上的数字位流进行分析。因此，测量仅限于传输流分析。


`POLQA是最新的，其他都是小弟。`
![CzlEBt](https://gitee.com/chasays/mdPic/raw/master/uPic/CzlEBt.jpg)

- [PESQ](https://en.wikipedia.org/wiki/Perceptual_Evaluation_of_Speech_Quality)

Perceptual Evaluation of Speech Quality
PESQ结合了PSQM和 PAMS的优势，针对VoIP和混合的端到端应用作了改进，并针对MOS和MOS-LQ计算方法做了修改。
也是全参考测试算法
```py
## first, install soundfile and pypesq
import soundfile as sf
from pypesq import pesq

ref, sr = sf.read("sine.wav")
deg, sr = sf.read("sine1.wav")
score = pesq(ref, deg, sr)

print(111,score)
```

得到的score分数就是[MOS的值](https://en.wikipedia.org/wiki/Mean_opinion_score)

输出结果
```sh
4.5
```

计算方法
>https://pypi.org/project/pesq/




- POLQA PESQ的升级版 percptual objective listening quality analysis
```python
# here is the implementation
https://chromium.googlesource.com/external/webrtc/+/3c1e558449309be965815e1bf/webrtc/audio/test/low_bandwidth_audio_test.py
```

并扩展到处理更高带宽的音频信号。进一步的改进针对时间调用信号的处理，具有许多延迟变化。
全参考算法，在对参考和测试信号的相应摘录进行时间对齐后，对语音信号进行采样分析 ，对于端到端的质量评估。



- 其他
[ViSQOL (Virtual Speech Quality Objective Listener) is an objective](https://github.com/google/visqol) google的一个全参考

前面提到的都是全参考的, 无参考, 马上就来.看下面这个就是实际的应用.

[FAD 一种新颖的，无参考的音乐增强算法评估指标](https://github.com/google-research/google-research/tree/master/frechet_audio_distance)


```py

python -m frechet_audio_distance.compute_fad --background_stats stats/background_stats --test_stats stats/test1_stats
python -m frechet_audio_distance.compute_fad --background_stats stats/background_stats --test_stats stats/test2_stats
```
------
# Video

- [PEVA](https://en.wikipedia.org/wiki/Perceptual_Evaluation_of_Video_Quality)
测量算法可用于分析由数字视频编码/解码（或转码）过程、基于无线电或 IP 的传输网络和最终用户设备引起的可见伪影。
 
PEVQ还通过各种KPI（包括PSNR、失真指示器和唇部同步延迟）来量化视频信号中的异常。

psnr是“Peak Signal to Noise Ratio”的缩写，即峰值信噪比，是一种评价图像的客观标准，它具有局限性，一般是用于最大值信号和背景噪音之间的一个工程项目。

PSNR是最普遍，最广泛使用的评鉴画质的客观量测法，不过许多实验结果都显示，`PSNR的分数无法和人眼看到的视觉品质完全一致`，有可能PSNR较高者看起来反而比PSNR较低者差。这是因为人眼的视觉对于误差的敏感度并不是绝对的，其感知结果会受到许多因素的影响而产生变化

SSIM(structural similarity index)，结构相似性，是一种衡量两幅图像相似度的指标。该指标首先由德州大学奥斯丁分校的图像和视频工程实验室(Laboratory for Image and Video Engineering)提出。SSIM使用的两张图像中，一张为未经压缩的无失真图像，另一张为失真后的图像。

------
 
 # 应用

 [webrtc](https://github.com/webrtc)
 WebRTC是一个免费的开放软件项目，可通过简单的API为浏览器和移动应用程序提供实时通信（RTC）功能。 WebRTC组件已经过优化，可以最好地满足此目的。


 [testrtc](https://github.com/webrtc/testrtc)
 这里包含audio和video的测试和评估方法. 
------
- mic
主要是针对audio
1. 能否2s静音
2. 计算RMS值
3. clip测试
4. 单双讲测试
------
- camara
分2部分, 一个WxH分辨率(width x height) 和支持的分辨率

 第一部分
1. 检查摄像机能否以请求的分辨率捕获 5 秒钟
1. 检查帧是冻结还是静音/黑色
1. 检测开始编码帧的时间
1. 报告编码时间和平均帧速率

第二部分
1. 列出似乎受支持的分辨率
------
- 网络
1. Udp/Tcp  `验证它可以使用给定协议与转服务器进行通信`
1. IPv6 连接  `验证它至少可以收集一个 IPv6 候选者`

------
- 连接性 (主要TURN server 连接的验证)

1. relay  可以通过 [TURN](https://webrtc.org/getting-started/turn-server) 服务器在对等体之间建立连接 
1. Reflexive 通过 NAT 验证对等体之间的连接
1. Host 验证可以在具有相同 IP 地址的对等体之间建立连接

------
- 吞吐量
1. 数据吞吐量 `建立环回调用并测试链路上的数据通道吞吐量`
1. 视频带宽
建立环回呼叫并测试链路上的视频性能

在媒体通道上测量 `rtt。`

测量带宽估计`性能（增加时间、最大值、平均值`）

>[py_quality_assessment](https://chromium.googlesource.com/external/webrtc/+/3c1e558449309be965815e1bf/webrtc/modules/audio_processing/test/py_quality_assessment/)

# read more
- https://ai.googleblog.com/2019/10/audio-and-visual-quality-measurement.html
- https://blog.csdn.net/foolskindom/article/details/5155587?utm_medium=distribute.pc_relevant.none-task-blog-title-3&spm=1001.2101.3001.4242
- https://blog.csdn.net/sinat_35821976/article/details/80081176
- https://wenku.baidu.com/view/33e49080d0d233d4b14e697d.html
